<!DOCTYPE html>
<head>
<meta charset="utf-8">
<title>Tahoe river data</title>
<style>
body {
	font: 12px "Helvetica Neue", Helvetica, Arial, sans-serif;
	background: #f9f9f9;
	color: #292929;
  width: 680px;
  margin: 20px auto;
}
pre {
  height: 200px;
  overflow: auto;
  tab-size: 18;
}
</style>
</head>

<body>
<h2>Tahoe River Sensors with Temperature</h2>
<p>TSV Data from <a href="http://waterdata.usgs.gov/">USGS Water Data</a></p>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.14/d3.js"></script>
<script src="https://d3js.org/d3-queue.v2.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.2.1/lodash.min.js"></script>

<script>
var sensors = [
  {
    name: "Upper Truckee Rv at South Lake Tahoe, CA",
    id: "10336610"
  },
  {
    name: "General C nr Meeks Bay CA",
    id: "10336645"
  },
  {
    name: "Blackwood C nr Tahoe City CA",
    id: "10336660"
  },
  {
    name: "Ward C at Why 89 nr Tahoe Pines, CA",
    id: "10336676"
  },
  {
    name: "Trout Ck nr Tahoe Valley, CA",
    id: "10336780"
  }
];

var air_resources = {
  proxy: "http://stamen-simple-cors.herokuapp.com/usgs-waterdata/?cb_00010=on&cb_00060=on&cb_00065=on&cb_70969=on&cb_63680=on&format=rdb&period=7&begin_date=2016-03-18&end_date=2016-03-25&site_no=",
  home: "http://waterdata.usgs.gov/ca/nwis/uv?",
  tsv: "http://waterdata.usgs.gov/ca/nwis/uv?cb_00010=on&cb_00060=on&cb_00065=on&cb_70969=on&cb_63680=on&format=rdb&period=7&begin_date=2016-03-18&end_date=2016-03-25&site_no=",
  local: "upper-truckee.tsv"
};

sensors.forEach(function(sensor) {
  d3.text(air_resources.proxy + sensor.id, function(error, raw_data) {
    var tsv_text = raw_data
      .split("\n")
      .filter(function(d) {
        return d.indexOf("#") !== 0;
      })
      .join("\n");

    var data = d3.tsv.parse(tsv_text);

    d3.select("body")
      .append("h3")
      .text(sensor.name + " (" + sensor.id + ")");

    d3.select("body")
      .append("div")
      .append("a")
      .attr("href", air_resources.home + sensor.id)
      .text("Overview");

    d3.select("body")
      .append("div")
      .append("a")
      .attr("href", air_resources.tsv + sensor.id)
      .text("TSV");

    d3.select("body")
      .append("pre")
      .text(d3.tsv.format(data));
  });
});
</script>
